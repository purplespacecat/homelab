# Open WebUI Helm Chart Custom Values
# Chart: open-webui/open-webui
# Installation: helm install open-webui open-webui/open-webui -f values.yaml --namespace open-webui --create-namespace

# IMPORTANT: Do NOT scale beyond 1 replica during updates (database corruption risk)
replicaCount: 1

image:
  repository: ghcr.io/open-webui/open-webui
  tag: "latest"
  pullPolicy: IfNotPresent

# Ollama configuration
ollama:
  # Use existing Ollama deployment instead of bundled chart
  enabled: false

# External Ollama API endpoints
ollamaUrls:
  - http://ollama.ollama.svc.cluster.local:11434

# Open WebUI configuration
openaiBaseApiUrl: ""  # Leave empty to use Ollama only

# Persistence for chat history, user data, etc.
persistence:
  enabled: true
  storageClass: nfs-client
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  # Database and uploads stored here
  annotations: {}

# Service configuration
service:
  type: LoadBalancer  # MetalLB will assign external IP
  port: 80
  containerPort: 8080
  nodePort: ""
  labels: {}
  annotations: {}

# Ingress configuration
ingress:
  enabled: true
  class: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"  # For document uploads
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  host: open-webui.192.168.100.98.nip.io  # Node IP where NGINX Ingress listens
  tls: []
  # Uncomment for TLS:
  # tls:
  #   - secretName: open-webui-tls
  #     hosts:
  #       - open-webui.192.168.100.98.nip.io

# Resource limits
resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# Environment variables
extraEnvVars:
  - name: ENABLE_RAG_WEB_SEARCH
    value: "true"
  - name: ENABLE_IMAGE_GENERATION
    value: "false"
  - name: WEBUI_AUTH
    value: "true"  # Enable authentication
  # - name: DEFAULT_USER_ROLE
  #   value: "user"

# Security context
podSecurityContext:
  {}
  # fsGroup: 2000

securityContext:
  {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Pipelines (for additional processing)
pipelines:
  enabled: false
  # Enable if you want to use custom pipelines

# Annotations
annotations: {}

# Update strategy
strategy:
  type: Recreate  # Prevent concurrent database access
