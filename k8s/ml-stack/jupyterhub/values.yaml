# JupyterHub Helm Chart Custom Values
# Chart: jupyterhub/jupyterhub
# Installation: helm install jupyterhub jupyterhub/jupyterhub -f values.yaml --namespace jupyterhub --create-namespace

# Proxy configuration
proxy:
  secretToken: ""  # Generate with: openssl rand -hex 32
  service:
    type: LoadBalancer  # MetalLB

# Hub configuration
hub:
  config:
    JupyterHub:
      admin_access: true
      authenticator_class: dummy  # Change to 'nativeauthenticator' for production
    DummyAuthenticator:
      password: "jupyter"  # Change this!

  # Resources for hub
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  # Persistent storage for hub database
  db:
    type: sqlite-pvc
    pvc:
      storageClassName: nfs-client
      accessModes:
        - ReadWriteOnce
      storage: 1Gi

# Single user notebook configuration
singleuser:
  # Default image with Python, data science libraries
  image:
    name: quay.io/jupyterhub/scipy-notebook
    tag: "latest"
    pullPolicy: IfNotPresent

  # CPU/Memory limits per user
  cpu:
    limit: 2
    guarantee: 0.5
  memory:
    limit: 2G
    guarantee: 512M

  # Storage per user
  storage:
    type: dynamic
    capacity: 5Gi
    dynamic:
      storageClass: nfs-client
    homeMountPath: /home/jovyan

  # Default environment (Ollama connection, etc.)
  extraEnv:
    OLLAMA_HOST: "http://ollama.ollama.svc.cluster.local:11434"

  # Install additional packages on notebook startup
  lifecycleHooks:
    postStart:
      exec:
        command:
          - "sh"
          - "-c"
          - >
            pip install --quiet --no-cache-dir
            langchain langchain-community
            ollama
            chromadb
            mlflow
            requests

  # Default to running as jovyan user
  uid: 1000
  fsGid: 100

# Scheduling configuration
scheduling:
  userScheduler:
    enabled: false  # Disable for small clusters
  podPriority:
    enabled: false
  userPlaceholder:
    enabled: false  # Disable for resource efficiency

# Ingress configuration
ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
  hosts:
    - jupyter.192.168.100.202.nip.io  # Adjust to your ingress IP
  tls: []

# Pre-pull images (optional, speeds up first launch)
prePuller:
  hook:
    enabled: false  # Disable for faster deployments
  continuous:
    enabled: false

# Culling idle notebooks
cull:
  enabled: true
  timeout: 3600  # Cull after 1 hour of inactivity
  every: 600  # Check every 10 minutes
  maxAge: 0  # Don't cull based on age
